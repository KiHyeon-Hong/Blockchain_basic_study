## 블록체인 기술 기초 공부 참고문헌

- https://arxiv.org/abs/1906.11078

## 블록체인이란?

- 블록체인은 일반적으로 중앙의 기관 없이 구현되는 분산 방식의 변조 방지 디지털 원장이다. 기본적으로 사용자가 블록체인 네트워크에 트랜잭션을 기록할 수 있으며, 이는 네트워크의 정상적인 작동 하에서 트랜잭션이 게시되면 이는 변경할 수 없다.
- 블록체인은 블록으로 그룹화되어 암호화, 서명화 된 트랜잭션의 분산 디지털 원장이다. 각 블록은 유효성 검사, 합의에 따라 이전 블록과 암호화된 방식으로 연결되며, 새로운 블록은 네트워크 내의 원장 사본에 복사되고, 충돌이 발생한다면 미리 설정한 규칙에 따라 자동적으로 문제를 해결한다.

## 블록체인의 분류 (Permissionless VS Permissioned)

### Permissionless

- 어떠한 기관의 허가 없이 블록을 게시하는 모든 사람에게 개방된 탈중앙화 원장 플랫폼이다.
- 대부분이 오픈 소스 소프트웨어이며, 다운로드하려는 모든 사람이 무료로 사용할 수 있다. 누구나 블록을 게시할 수 있는 권리가 있으므로 일부 악의적인 사용자는 시스템을 전복시키기 위한 목적으로 블록을 게시하려고 시도할 수 있다. 이를 방지하기 위해 합의 시스템(예를 들어, Pos, Pow 등)을 활용한다.
- 합의 시스템은 일반적으로 프로토콜을 준수하는 블록 게시자(Miner, 채굴자)에게 암호화폐를 보상하여 악의적이지 않는 행동을 하도록 한다.

### Permissioned

- 사용자, 또는 노드가 일부 권한을 승인 받아야 하는 블록체인 네트워크이다. (권한의 승인을 중앙 집중형에서 받든, 분산형에서 받든)
- 승인된 개인만이 트랜잭션을 제출할 수 있다. 따라서 무허가 블록체인 네트워크와 같은 리소스를 과하게 소비하는 합의 방식은 필요로 하지 않는다. (이미 승인되어 신뢰할 수 있는 사용자로 보기 때문에)
- 참여하기 위해 본인의 신원 확인이 필요하며, 사로간의 신뢰로 네트워크가 유지된다.

## 블록체인의 구성 요소

### 암호화를 위한 해시 함수

- 블록체인 네트워크에서 해시 함수(SHA-256 등)는 다양한 작업에 사용된다.

#### 사용 예시

- Address derivation.
- Creating unique identifiers.
- Securing the block data: a publishing node will hash the block data, creating a digest that will be stored within the block header.
- Securing the block header: a publishing node will hash the block header. If the blockchain network utilizes a proof of work consensus model, the publishing node will need to hash the block header with different nonce values until the puzzle requirements have been fulfilled. The current block header’s hash digest will be included within the next block’s header, where it will secure the current block header data.

### 암호화 nonce

- nonce는 한번만 사용되는 임의의 숫자이다.
- 데이터와 결합하여 nonce마다 다른 해시를 생성한다.

```
hash(data + nonce) = digest
```

- 즉, nonce 값만 변경하면 동일한 데이터에 대해 다른 다이제스트(digest) 값을 얻을 수 있으며, 이는 작업 증명 합의 모델에서 사용한다.

### 거래

- 블록체인 네트워크의 각 블록에는 0개 이상의 트랜잭션이 포함될 수 있다. 블록체인 네트워크의 보안을 유지하기 위해 새로운 블록의 지속적인 공급은 매우 중요하다. 이를 위해 트랜잭션이 발생하지 않더라도 지속해서 블록을 생성하여야 한다.
- 새로운 블록을 지속적으로 공급함으로써 악의적인 사용자가 더 길고 위조된 블록체인을 제조하는 것을 방지한다.
- 또한, 거래의 유효성과 신뢰성을 결정하는 것은 매우 중요하다. 트랜잭션의 유효성은 프로토콜 요구 사항 및 블록체인 네트워크의 구현과 관련된 모든 형식화된 데이터 형식, 또는 스마트 계약 요구 사항을 충족하는 지 확인한다. 거래의 진위 여부는 디지털 자산의 발신자가 해당 디지털 자산에 엑세스할 수 있는지 여부를 결정하므로, 매우 중요하다.
- 트랜잭션은 일반적으로 발신자의 개인 키로 디지털 서명되며, 매칭되는 공개 키를 이용하여 언제든지 확인할 수 있다.

![Figure1](https://kihyeon-hong.github.io/Collection_of_repository_images/Blockchain_basic_study/figure1.JPG)

### 비대칭키 암호화 (공개키 암호화)

- 블록체인 네트워크의 사용자가 보유한 개인키로 암호화하고 공개키로 복호화하는 방식을 취할 수 있으며, 반대로 공개키로 암호화하고 개인키로 복호화하는 방식을 취할 수도 있다.
- 키 암호화는 트랜잭션을 공개 상태로 유지하는 동시에 트랜잭션의 무결성과 신뢰성을 확인하는 매커니즘을 제공하여 서로를 모르거나 신뢰하지 않는 사용자 간의 신뢰 관계를 가능하도록 한다.

#### 디지털 서명

- 개인키를 사용하여 트랜잭션을 암호화하면 공개키를 가진 사람들은 누구나 암호를 해독할 수 있다. 공개키는 자유롭게 사용할 수 있으므로, 개인키로 트랜잭션을 암호화하면, 트랜잭션 디지털 서명자가 개인키에 엑세스할 수 있음이 증명된다.
- 또는, 개인키에 액세스할 수 있는 사용자만 암호를 해독할 수 있도록 공개키로 데이터를 암호화할 수도 있다.

##### 디지털 서명 사용 예시

- 블록체인 네트워크에서 사용한다.
- 개인키는 거래를 디지털 서명하는 데에 사용한다.
- 공개키는 주소를 파생하는 데에 사용한다.
- 공개키는 개인키로 생성된 서명을 확인하는 데에 사용한다.
- 비대칭 키 암호화는 다른 사용자에게 화폐 등을 이전하는 사용자가 트랜잭션에 서명할 수 있는 개인키를 소유하고 있음을 증명 및 확인하는 기능을 제공한다.

### 주소 및 주소 파생

- 대부분의 블록체인 구현은 트랜잭션에서 "to" 및 "from"의 엔드포인트를 주소로 사용한다. 주소는 공개키보다 짧으며, 비밀이 아니다. 주소를 생성하는 한가지 방법은 공개키를 만들어 해시를 적용하고, 해시를 텍스트로 변환하는 방법이다.

```
public key -> cryptographic hash function -> address
```

- 주소는 사용자가 블록체인 네트워크에서 공개 식별자 역할을 할 수 있으며, 종종 주소는 모바일에서도 쉽게 사용할수 있도록 QR코드로 변환된다.

### 개인키 저장

- 블록체인 네트워크의 사용자는 자신의 개인키를 관리하고 안전하게 저장해야 한다.
- 사용자가 개인키를 분실한다면 동일한 개인키를 재생성하는 것은 불가능하기 때문에 해당 키와 관련된 모든 디지털 자산이 손실된다. 반대로 개인키를 도난당한다면 공격자는 해당 개인키가 제어하는 모든 디지털 자산에 대해 전체 액세스 권한을 갖는다.
- 암호화폐가 도난 당했다는 것은 일부 개인키가 발견되어 새 계정으로 돈을 보내는 거래에 사용되었음을 의미한다. 블록체인 데이터는 변경할 수 없으므로, 개인키를 훔치고 자산을 이체한다면 해당 거래를 취소하는 것은 불가능하다.

### 원장

- 트랜잭션의 모음이다.
- 블록체인 네트워크는 설계에 따라 분산되어 각 피어 간에 동일한 원장 데이터를 업데이트하고 동기화하는 많은 복사본을 생성한다. 새로운 노드가 블록체인 네트워크에 합류할 때마다 다른 노드를 찾아 블록체인 네트워크 원장의 전체 사본을 요청하여 원장의 손실이나 파괴를 어렵게 한다.
- 블록체인 네트워크는 SW, HW, 그리고 네트워크 인프라가 모두 다른 이기종 네트워크이다. 블록체인 네트워크 노드 사이에는 많은 차이점이 있기 때문에 하나의 노드에 대한 공격이 다른 노드에서도 작동한다는 보장이 없다.
- 블록체인 네트워크는 전 세계에서 지리적으로 다양한 노드로 구성된다. P2P 방식으로 작동하는 블록체인 네트워크는 손실에 대해 탄력적이다.
- 블록체인 네트워크는 모든 거래(트랜잭션)이 유효한지 확인해야 한다. 악의적인 노드가 트랜잭션을 전송하면 다른 사람들이 이를 감지하고 무시하여 잘못된 트랜잭션이 전파되는 것을 방지한다.
- 블록체인 네트워크는 분산 원장 내에서 수락된 모든 트랜잭션을 보유한다. 새 블록을 구축하기 위해 이전 블록을 참조해야 하므로 게시 노드에 최신 블록에 대한 참조가 포함되어 있지 않으면, 다른 노드는 이를 거부한다.
- 블록체인 네트워크는 디지털 서명 및 암호화 해시 가능을 사용하여 변조 방지를 제공한다.
- 일반적으로 블록체인 네트워크의 정보는 공개적으로 볼 수 있으며, 훔칠 것이 없다. 블록체인 네트워크의 사용자를 공격하려면 개별적으로 대상을 지정해야 한다. 또한, 블록체인 자체를 공격에 대한 목표로 하는 것은 신뢰성 있는 노드의 저항에 부딪힌다.

### 블록

- 블록체인 네트워크의 사용자는 블록체인 네트워크에 후보 트랜잭션을 제출한다. 제출된 트랜잭션을 다른 노드로 전파하지만, 블록화 하지는 않는다. 게시 노드가 블록을 게시할 때 트랜잭션이 블록체인에 추가된다. 블록 헤더에는 이 블록에 대한 메타데이터가 포함된다.
- 블록 데이터에는 블록체인 네트워크에 제출된 검증되고 인증된 트랜잭션 목록이 포함된다. 트랜잭션의 형식이 올바르고 각 트랜잭션의 디지털 자산 제공자가 각각 암호화된 트랜잭션에 서명하였는지 확인하여 유효성과 신뢰성을 보장한다. 이를 통해 거래에 대한 디지털 자산 제공자가 사용 가능한 디지털 자산에 서명할 수 있는 개인키를 보유하는 지 확인한다.
- 다른 전체 노드는 게시된 블록에 있는 모든 트랜잭션의 유효성과 신뢰성을 확인하고, 유효하지 않은 트랜잭션이 포함된 블록은 수락하지 않는다.

#### 블록의 구조

##### 블록 헤더

- The block number, also known as block height in some blockchain networks.
- The previous block header’s hash value.
- A hash representation of the block data (different methods can be used to accomplish this, such as a generating a Merkle tree, and storing the root hash, or by utilizing a hash of all the combined block data).
- A timestamp.
- The size of the block.
- The nonce value. For blockchain networks which utilize mining, this is a number which is manipulated by the publishing node to solve the hash puzzle. Other blockchain networks may or may not include it or use it for another purpose other than solving a hash puzzle.

##### 블록 데이터

- A list of transactions and ledger events included within the block.
- Other data may be present.

## 합의 모델 (합의 알고리즘)

- 블록체인 네트워크 기술의 핵심은 다음 블록을 게시할 사용자를 결정하는 것이다. 이는 합의 모델 중 하나를 구현하여 해결한다.
- 예를 들어, 무허가 블록체인 네트워크의 경우에는 일반적으로 다음 블록을 게시하기 위해 동시에 경쟁하는 많은 게시 노드가 있다. (수수료를 얻기 위해)
- 이러한 상황에서 사용자가 다른 사용자가 게시하려는 블록을 전파하는 이유와 여러 노드가 거의 동시에 블록을 게시할 때 충돌을 해결해야 한다.

### 기본적인 해결 방법

- 사용자가 블록체인 네트워크에 가입한다는 것은 시스템의 초기 상태에 동의하는 것이다. 이것은 사전에 구성된 유일한 블록에 기록된다.
- 제네시스 블록(가장 처음의 블록)이 있으며, 합의된 합의 모델에 따라 모든 블록이 그 이후에 블록에 추가(연결)된다. 그러나 모델과 관계 없이 각 블록은 유효해야 하므로, 각 블록체인 네트워크의 사용자가 독립적으로 이를 검증할 수 있다.
- 초기 상태와 이후 모든 블록을 검증하는 기능을 결합하여 사용자는 블록체인의 현재 상태에 대해 독립적으로 동의할 수 있다.
- 기본적으로 매커니즘은 더 긴 블록체인을 올바른 것으로 간주하여 채택한다. 이는 가장 많은 작업을 투입했기 때문에 신뢰성이 있다고 판단한다.
- 블록체인에 새 블록을 추가하려면 모든 노드가 시간이 지남에 따라 공통된 합의에 도달하여야 한다. 그러나 일시적인 의견 차이는 허용한다. (악의적인 공격자가 있는 경우에도 작동하여야 한다.)

### 작업 증명(PoW) 합의 모델

- 퍼즐을 푸는 것은 매우 어렵지만, 정답이 맞는지 확인하는 과정을 매우 쉽도록 설계되어 있다. 이를 통해 다른 모든 전체 노드는 제안된 다음 블록을 쉽게 검증할 수 있으며, 충족하지 않은 블록은 거부한다.
- 일반적으로 퍼즐 방법은 블록 헤더의 해시 다이제스트가 목표 값보다 작도록 요구하는 것이다. 이를 위해 nonce 값을 변경하며 해시를 계산한다.
- 각각의 블록은 독립적이기 때문에 유효한 블록을 수신한다면, 그 즉시 현재 작업을 버리고 새로 수신된 블록을 검증 및 구축한다.

```
SHA256(“blockchain” + Nonce) = Hash Digest starting with “000000”
```

- 퍼블리싱 노드가 이 작업을 수행하고, 유효한 nonce가 포함된 블록을 네트워크의 전체 노드로 보낸다. 수신자인 전체 노드는 새 블록이 퍼즐 요구사항을 충족하였는지 확인한 다음, 블록을 자신의 블록체인 사본에 추가하고, 피어 노드로 보낸다. 이를 통해 새 블록은 네트워크 전체에 배포된다.

### 지분 증명(PoS) 합의 모델

- 사용자가 시스템에 더 많은 지분을 투자하고 있을수록 시스템이 성공하기를 원할 가능성이 높고, 시스템을 전복시키고 싶어할 가능성이 적다는 아이디어를 기반으로 한다. Stake는 블록체인 네트워크의 사용자가 시스템에 투자한 암호화폐의 양이다. 일단 스테이킹되면 암호화폐는 일반적으로 더 이상 사용할 수 없다.
- 블록체인 네트워크의 사용자가 새 블록을 게시할 가능성은 전체 블록체인 네트워크 스테이킹된 암호화폐의 양에 대한 지분의 비율과 관련이 있다.
- 작업 증명에서 볼 수 있는 리소스 집약적인 계산이 필요없다. 그러므로 채굴마다 새로운 암호화폐가 생성되는 것이 아니라, 모든 화폐는 이미 사용자에게 배포되어 있으며, 블록 발행에 대한 보상은 일반적으로 사용자가 제공한 거래 수수료를 얻는 것이다.

### 라운드 로빈 합의 모델

- 일부 허가된 블록체인 네트워크에서 사용하는 방식이다.
- 노드는 교대로 블록을 생성하며, 개시 노드가 블록을 게시할 수 없는 상황을 처리하기 위해 사용 가능한 노드가 블록 게시를 중단하지 않도록하는 시간 제한 기법이 포함될 수 있다.
- 노드 간의 신뢰가 필요하기 때문에 대부분의 암호화폐에서 사용하는 무허가 블록체인 네트워크에서는 적합하지 않다. 악성 노드가 지속적으로 노드를 추가하여 새 블록을 게시할 확률을 높일 수 있기 때문이다.

### 권한 증명 / 신원 증명 합의 모델

- 실제 ID에 대해 알려진 링크를 통해 게시 노드의 부분적인 신뢰에 의존한다. 게시 노드는 네트워크 내에서 신원이 입증되고 검증 가능해야 한다.
- 게시 노드가 새 블록을 게시하기 위해 ID/평판을 걸고 있다. 블록체인 네트워크 사용자는 게시 노드의 동작에 따라 게시 노드의 평판에 직접적인 영향을 준다. 게시 노드는 사용자가 동의하는 방식으로 행동하여 명성을 얻을 수 있는 것처럼, 블록체인 네트워크 사용자가 동의하지 않은 방식으로 행동하여 명성을 잃을 수도 있다. 평판이 낮을 수록 블록을 게시할 수 있는 가능성이 줄어든다.
- 높은 수준의 신뢰를 가진 허가된 블록채인 네트워크에만 적용할 수 있다.

### 경과 시간(PoET) 합의 모델

- 각 게시 노드는 컴퓨터 시스템 내의 보안 HW 시간 소스에서 대기 시간을 요청한다. 임의의 대기 시간을 생성하고 게시 노드는 임의의 시간을 갖고 해당 네트워크에서 유휴 상태가 된다. 게시 노드가 깨어나면 블록을 생성하고 블록체인 네트워크에 게시한다. 유휴 상태인 모든 게시 노드는 대기를 중지하고 전체 프로세스가 다시 시작한다.
- 이 모델은 대기 시간이 무작위로 선택되지 않은 경우 악의적인 게시 노드가 기본적으로 시스템을 지배하기 위해 최소한의 시간만 기다리므로 임의 시간이 사용되었는지 확인해야 한다.
- 검증되고 신뢰할 수 있는 SW는 이러한 보안 실행 환경에서 실행할 수 있으며, 외부 프로그램에 의해 변경될 수 있다.
- 게시 노드는 할당된 시간을 기다린 후 게시 노드가 무작위로 할당된 시간을 기다린 서명된 인증서를 요청할 수 있다. 그 다음 게시 노드는 블록과 함께 인증서를 게시한다.

## 원장 충돌 및 해결 방법

-
